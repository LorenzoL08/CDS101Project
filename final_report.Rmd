---
title: "CDS 101 – Final Project Report"
author: "Team 3: Athir, Lorenzo, Abel"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
documentclass: article
geometry: margin=1in
fontsize: 11pt
output:
  pdf_document:
    toc: false
    df_print: kable
    fig_caption: false
    number_sections: false
    dev: pdf
    highlight: tango
  html_document:
    css: "gmu-cds101.css"
    toc: true
    toc_depth: 3
    number_sections: true
---
```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(dplyr)
library(rmarkdown)
library(knitr)

packages <- c(
  "tidyverse",
  "ggplot2",
  "dplyr",
  "readr",
  "rmarkdown",
  "knitr"
)

install_if_missing <- function(pkgs) {
  for (p in pkgs) {
    if (!requireNamespace(p, quietly = TRUE)) {
      message(sprintf("Installing package: %s", p))
      install.packages(p)
    } else {
      message(sprintf("Package already installed: %s", p))
    }
  }
}

install_if_missing(packages)
```
# 1. Problem Definition


Burglary is a crime that is the cause of significant safety and financial concerns for residents of urban areas. Understanding when burglaries are most likely to occur can help our communities, law enforcement, and policymakers better understand and implement preventative measures. The Washington Dc area is a large and densely populated area, making it an important case study for examining certain crimes and patterns of those crimes. 

The main research question for this project is: **Does the frequency of burglary incidents in the DC Metro area differ across different times of day?** The main objective of this project is to use historical crime data to examine how burglary occurrences vary by time of day and to test whether these differences are significant. We assume that reported burglary data accurately shows real crime patterns, and that the time of day classifications are recorded in a consistent way.

To address this research question, we will first load and inspect the DC Metro Crime dataset. We will then clean the data by filtering for burglary offenses and handling missing values in the time of day variable. Next, we will do some exploratory data analysis using summaries and visualizations to examine how burglary frequency varies by shift. Finally, we will perform a formal hypothesis test to determine whether the observed differences across times of day are statistically significant, and interpret the results.


# 2. Data Acquisition & Description

The dataset used for this project is the **DC Metro Crime Dataset**, obtained from Kaggle. It contains records of reported criminal incidents in the Washington, DC metro area.

The dataset was obtained by downloading the CSV file from the Kaggle website and storing it locally in the project data folder for analysis.

Key variables used in this project include:

- **offense (categorical)**: the type of crime committed (for example, burglary).

- **shift (categorical)**: the time of day the crime occurred, categorized as Day, Evening, or Midnight.

The full dataset contains 342,864 observations and 32 variables. Due to GitHub file size limits, the dataset was split into two CSV files, dc_crime_part1.csv and dc_crime_part2.csv, which together is the complete dataset.


This dataset is based on publicly released government crime reports, so it does not contain personal identifying information. However, we believe potential reporting bias may exist, as not all crimes are reported equally across neighborhoods or times. Additionally, policing practices and data collection methods may influence recorded crime frequencies.



```{r setup-data, echo=FALSE, message=FALSE, warning=FALSE}

# We will load both parts of the dataset
dc_part1 <- read.csv("data/dc_crime_part1.csv")
dc_part2 <- read.csv("data/dc_crime_part2.csv")

#combine
dc_crime <- bind_rows(dc_part1,dc_part2)

```

# 3. Data Cleaning & Preprocessing

Before conducting our analysis, the raw DC Metro Crime dataset was cleaned and preprocessed to make sure everything was accurate and consistent.

Records with missing or not valid values in key variables, mainly shift (time of day) and offense, were removed from the dataset. These variables are required for answering the research question, so incomplete values could not be used.

Several variables were converted to appropriate data types:

- **shift** and **offense** were converted to categorical variables.

- **date** and **time-related fields** were formatted into proper date types where needed.
This made sure that grouping, filtering, and tests could be done correctly.

No numerical outliers were removed because the analysis focuses on categorical variables of burglary incidents and not continuous numeric measurements. Every valid burglary report was kept to keep the validity of the crime distribution.

The dataset was filtered to include only burglary offenses, since burglary is the main focus of the research question. This created a new working dataset we used for modeling and hypothesis testing. Additionally, the shift variable was used as the main grouping variable to compare burglary frequency across times of day.

No numeric scaling was required because the analysis does not rely on continuous predictors.


```{r cleaning}
#Need to keep only the variables we need
dc_clean <- dc_crime %>%
  select(OFFENSE,SHIFT, REPORT_DAT)

#Need to remove missing values in the variables
dc_clean <- dc_clean %>%
  filter(!is.na(OFFENSE), !is.na(SHIFT))

#Now we need to convert the data types
dc_clean <- dc_clean %>%
  mutate(
    OFFENSE = as.factor(OFFENSE),
    SHIFT = as.factor(SHIFT),
    REPORT_DAT = as.Date(REPORT_DAT, format = "%m/%d/%Y")
  )

#Now we filter for Burglary only
dc_burglary <- dc_clean %>%
  filter(OFFENSE == "BURGLARY")
```

# 4. Exploratory Data Analysis (EDA)

This section presents descriptive statistics and visualizations of burglary incidents across different times of day. The goal is to explore whether burglary frequency varies by shift, which directly supports the project’s research question. 

```{r eda-summary, message=FALSE, warning=FALSE}
burglary_summary <- dc_burglary %>%
  group_by(SHIFT) %>%
  summarize(
    Count = n(),
    Percentage = round(100 * n() / nrow(dc_burglary), 1)
  )

burglary_summary  
```

### **Interpretation**

The percentage column represents the share of total burglary incidents occurring in each shift. For example, the evening shift accounts for approximately 43.6% of all burglaries, followed by the day shift at 40% and the midnight shift at 16.4%.





```{r eda-plot-example, message=FALSE, warning=FALSE, fig.cap="Histogram showing the distribution of burglary incidents over time in the DC Metro area"}
fig.cap = "Histogram showing the distribution of burglary incidents over time in the DC Metro area"

ggplot(dc_burglary, aes(x = REPORT_DAT)) +
  geom_histogram(binwidth = 30) +
  labs(
    title = "Distribution of Burglary Incidents Over Time",
    x = "Report Date",
    y = "Number of Burglary Incidents"
  )
```

### **Interpretation**

This histogram shows how reported burglary incidents are distributed over time. The overall spread of the distribution indicates that burglary occurs consistently throughout the study period, with some variation in frequency across years and months. This confirms that the dataset captures long-term burglary patterns rather than being concentrated in a short time window.

# 5. Visualization Quality and Storytelling

```{r}
dc_burglary %>%
  ggplot() +
    geom_bar(mapping = aes(x = SHIFT)) +
    labs(
    title = "Burglary Incidents by Shift",
    x = "Time of Day (Shift)",
    y = "Number of Burglary Incidents"
  )
```


```{r}
#Extracts year from report date in dc_burglary data set
dc_burglary_year <- dc_burglary %>%
  mutate(Year = year(REPORT_DAT))

#Counts Burglaries by Shift and Year
heatmap_burglary <- dc_burglary_year %>%
  group_by(SHIFT, Year) %>%
  summarise(Count = n())

heatmap_burglary%>%
  ggplot()+
  geom_tile(mapping = aes(x = SHIFT, y = Year, fill = Count))+
  scale_fill_gradient(low = "lightblue", high = "red")+
  labs(
    title = "Heatmap of Burglary Incidents by Shift",
    x = "Time of Day (Shift)",
    y = "Year"
  )
  
```
We used a bar graph to clearly show differences in time and the number of burglaries. Additionally, we also used a heat map plot for our analysis to help with storytelling and showcase the areas of density when it comes to the number of burglaries during a specific time in a specific year. This allows us to showcase the consistency in the number of burglaries during a time of day (Shift), as well as any potential inconsistencies. 

These plots are appropriate because our analysis focuses on categorical variables. Since our focus is on the time of day burglaries occur the most.

Both plots have clear titles and labeled axes. Our bar graph used the default colors so that all users can clearly see the difference in the number of burglaries and time without being distracted by extra details. Additionally, the heatmap utilized a legend to showcase the corresponding color with the count. For example, light blue represents a lower amount of burglaries, and red represents a higher amount of burglaries.

Lastly, all graphs go from left to right in an ascending order, day -> evening -> midnight. Allowing readers to clearly visualize the amount of burglaries occurring based on time.

# 6. Modeling Approach

The modeling approach was designed to directly answer the research question: Does the frequency of burglary incidents in the DC Metro area differ across times of day?

This task involves categorical data: we are not predicting burglary occurrences, but instead testing whether burglary counts differ by time of day across three categories (Day, Evening, Midnight). 

Before running any model, we created a baseline. If burglary is not correlated to the time of day, then it should occur across all shifts equally. This forms our null hypothesis for our test and acts as our baseline model. We also formed an alternative hypothesis : The proportion of burglaries occurring during the Evening shift is significantly higher than what would be expected under a random, equal distribution.


The primary model we used is the chi-square test of independence, which is the most appropriate model because we are comparing categorical variables to test for association. We are using SHIFT, a categorical variable with three parts of the day, we are testing for count and comparing distribution, rather than making predictions. The chi-square test evaluates whether frequencies differ from expected ones.

We decided not to use any other models as we are not trying to make any predictions. Using them in this context would not answer the research question as directly as the chi-square test. Overall, the chi-square test provides a clear way to evaluate and determine whether burglary incidents vary by shift. 

# 7. Model Implementation & Evaluation

This section uses a chi-squared goodness-of-fit test to check whether burglary incidents are equally common across the three shifts (Day, Evening, Midnight).

```{r modeling-summary, message=FALSE, warning=FALSE}
# Table of burglary counts and percentages by shift
burglary_shift_counts <- dc_burglary %>%
  group_by(SHIFT) %>%
  summarize(
    Count = n(),
    Percentage = round(100 * n() / nrow(dc_burglary), 1)
  )

burglary_shift_counts
```
### **Interpretation**
This table shows how many burglaries occur in each shift and what percentage of the total they represent. Evening and Day have the highest shares; Midnight has the fewest burglaries.

Chi-squared goodness-of-fit test for equal proportions across shifts

```{r modeling-chisq, message=FALSE, warning=FALSE}
burglary_shift_table <- table(dc_burglary$SHIFT)

chisq_burglary_shift <- chisq.test(
  x = burglary_shift_table,
  p = c(1/3, 1/3, 1/3) # equal expected proportions
)
chisq_burglary_shift
```

### **Interpretation**
The chi-squared test compares the observed counts to what we would see if burglaries were equally likely in each shift. The very small p-value (<< 0.05) means we reject equal proportions: burglary frequency depends on time of day.

```{r modeling-plot, message=FALSE, warning=FALSE, fig.cap="Observed vs expected burglary counts by shift under an equal-proportions model"}
observed_counts <- as.numeric(burglary_shift_table)
expected_counts <- as.numeric(chisq_burglary_shift$expected)

burglary_model_plot_data <- tibble(
  SHIFT = names(burglary_shift_table),
  Observed = observed_counts,
  Expected = expected_counts
) %>%
  pivot_longer(
    cols = c(Observed, Expected),
    names_to = "Type",
    values_to = "Count"
  )

ggplot(burglary_model_plot_data, aes(x = SHIFT, y = Count, fill = Type)) +
  geom_col(position = "dodge") +
  labs(
    title = "Observed vs Expected Burglary Counts by Shift",
    x = "Shift",
    y = "Number of Burglary Incidents",
    fill = "Count Type"
  )
```
### **Interpretation**
The plot shows that Day and Evening have more burglaries than expected under equal proportions, while Midnight has fewer. This visually supports the chi-squared result.

### Additional Hypothesis


**Alternative Hypothesis (H₁₂):**  
The proportion of burglaries occurring during the Evening shift is greater than what would be expected under an equal distribution across shifts.

We evaluate this hypothesis using a simulation-based approach that compares the observed Evening burglary proportion to proportions generated under random assignment.

```{r evening-simulation, message=FALSE, warning=FALSE}
set.seed(123)

# Total number of burglaries
n_total <- nrow(dc_burglary)

# Observed Evening burglary proportion
observed_evening_prop <- mean(dc_burglary$SHIFT == "EVENING")

# Simulate equal distribution across shifts
simulated_evening_props <- replicate(10000, {
  simulated_shift <- sample(
    c("DAY", "EVENING", "MIDNIGHT"),
    size = n_total,
    replace = TRUE
  )
  mean(simulated_shift == "EVENING")
})

#p-value
p_value_sim <- mean(simulated_evening_props >= observed_evening_prop)

observed_evening_prop
p_value_sim
```
### **Interpretation**
The observed proportion of burglaries occurring during the Evening shift is approximately 43.6%, which is way higher than the 33.3% expected under an equal-distribution assumption. This results in an empirical p-value of approximately 0, providing extremely strong evidence that burglaries occur way more often during the Evening shift. This simulation-based result independently confirms the conclusion of the chi-squared test.

# 8. Conclusions & Recommendations

Our main research question was:

Does the frequency of burglary incidents in the DC Metro area differ across different times of day (Day, Evening, Midnight)?

Based on the burglary data and our chi-squared goodness-of-fit test, we conclude that **burglary incidents are not equally common across shifts**. The Evening and Day shifts have the highest proportions of burglaries, while the Midnight shift has the fewest. The chi-squared test returned a very small p-value (much less than 0.05), so we reject the hypothesis that burglaries are equally likely at all times of day.

The most important pattern we found is that burglary risk is **concentrated during the Day and Evening**, rather than being spread evenly over 24 hours. This has practical implications: law enforcement and communities might focus more prevention, patrols, and awareness efforts during these higher-risk times.

However, our analysis has several limitations. The dataset contains only **reported** burglaries, so underreporting or reporting bias may affect the results. We also did not include other potentially important variables such as neighborhood, day of week, season, or year. Finally, we treated the three broad shifts as our only measure of time; more detailed time-of-day information might reveal additional patterns.

Future work could extend this project by:
- Adding **spatial information** (e.g., neighborhoods) to see where and when burglaries are most common.
- Using **finer time bins** (hourly or 2-hour blocks) instead of just three shifts.
- Comparing burglary with other crime types (e.g., robbery, motor vehicle theft) to see if their time-of-day patterns are similar or different.
- Examining **trends over years** to see whether the time-of-day pattern of burglaries is changing over time.

# 9. Code Quality & Reproducibility
All of the analysis for this project is contained in a single R Markdown file (this final project `.Rmd`). To reproduce our results, someone can:
- Open the project folder and load the `.Rmd` file in RStudio.  
- Make sure the required packages are installed, mainly:
  - `tidyverse`
  - `ggplot2` (included in tidyverse)
  - `knitr` and `rmarkdown` for knitting the report  
- Place the two data files (`dc_crime_part1.csv` and `dc_crime_part2.csv`) in the `data/` folder as used in the code.  
- Click **Knit** to generate the HTML or PDF report. This will automatically:
  - Load and combine the crime data,
  - Clean and filter it for burglary incidents,
  - Produce all tables, plots, and the chi-squared test output shown in the report.
We use consistent `dplyr` verbs for data cleaning and clear chunk labels (e.g., `setup-data`, `cleaning`, `eda-summary`, `modeling-summary`), which makes the workflow easy to follow. The R session information below documents the exact R version and package versions used, helping others reproduce the analysis.



# 10. References

References used:

- WNCC Math and Stats. (2020, July 23). Graphs for Categorical Data. YouTube. https://www.youtube.com/watch?v=gFs1VFviyPs

- GeeksforGeeks. (2021, June 27). Create Heatmap in R Using ggplot2. GeeksforGeeks.
https://www.geeksforgeeks.org/r-language/create-heatmap-in-r-using-ggplot2/

- https://chatgpt.com/share/693601d8-b3f0-8009-ad35-0e71d9c9034b

- How do I use R to count multiple variables? (n.d.). Stack Overflow.  https://stackoverflow.com/questions/60086041/how-do-i-use-r-to-count-multiple-variables

- GeeksforGeeks. (2024, May 3). ChiSquare Test. GeeksforGeeks. https://www.geeksforgeeks.org/maths/chi-square-test/
-Kaggle. *DC Metro Police Crime Incidents*. Retrieved from Kaggle dataset description page (accessed 2024).  
- Wickham, H., & Grolemund, G. (2017). *R for Data Science: Import, Tidy, Transform, Visualize, and Model Data*. O’Reilly Media. (Used for general guidance on data wrangling and visualization with `dplyr` and `ggplot2`.)
- Diez, D. M., Barr, C. D., & Çetinkaya-Rundel, M. (2019). *OpenIntro Statistics* (4th ed.). OpenIntro. (Consulted for theory and interpretation of the chi-squared goodness-of-fit test.)
- R Core Team. (2024). *R: A Language and Environment for Statistical Computing*. R Foundation for Statistical Computing, Vienna, Austria. Available at: https://www.R-project.org/  
- Wickham, H. et al. (2019). *Welcome to the tidyverse*. Journal of Open Source Software, 4(43), 1686. (For the `tidyverse` collection of packages used in the analysis.)

# Appendix (Optional)

Include extra plots, diagnostic checks, or model comparisons if needed.
